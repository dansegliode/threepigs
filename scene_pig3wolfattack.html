<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Three Little Pigs</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Arapey" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.2.0/anime.min.js"></script>
	<link href="main.css" rel="stylesheet">
</head>

<body href="scene_endingstory.html" class="blackFade">
	<div id="content">
		<div class="grayMatCenter">
			<div id="fade1" class="grayMatGroup">
				<div class="grayMat " id="staticMat1"><img src="imgs/brickNormal.svg" alt="normal brick"></div>
				<div class="grayMat" id="staticMat2"><img src="imgs/brickNormal.svg" alt="normal brick"></div>
				<div class="grayMat" id="staticMat3"><img src="imgs/brickNormal.svg" alt="normal brick"></div>
			</div>
			<div class="pigChar" id="fade2"><img src="imgs/pig.svg" alt="pig character"></div>
			<div class="wolfChar" id="draggableMat1"><img id="fade3" src="imgs/wolf.svg" alt="wolf character"></div>
		</div>

	</div>

	<script>
	// radar animation function
	function playRadar(x, y, color) {

		let xPos = x;
		let yPos = y;
		console.log(xPos + " " + yPos);
		$("body").prepend(
			'	<div id="radarEffect"><div id="functionBasedDelay"><div class="line"><div class="beam am"><div class="beam am"><div class="beam am"></div></div></div></div></div></div>'
		);

		$(".beam").css('box-shadow', '0px 0px 5px ' + `${color}`);
		$(".beam").css('border', '2px solid ' + `${color}`);

		$("#radarEffect").css({
			position: "absolute",
			left: xPos,
			top: yPos
		});

		var functionBasedDelay = anime({
			targets: '#functionBasedDelay .am ',
			scale: 3,
			opacity: 0,
			loop: false,
			elasticity: 0,
			duration: 3000,
			delay: function (el, i, l) {
				return i * 100;
			}
		});

		setTimeout(function () {
			var element = document.body;
			var child = document.getElementById("radarEffect");
			element.removeChild(child);
		}, 1000);

	}

	function scaleAnimation(obj) {
		$(`${obj}`).addClass('boing');
		setTimeout(function () {
			$(`${obj}`).removeClass('boing');
		}, 400);
	}

	function wolfScatter() {
		let piece1, piece1X, piece1Y;

		piece1 = $(".wolfChar");


		piece1X = piece1[0].offsetLeft;
		piece1Y = piece1[0].offsetTop;

		piece1.addClass("wolfScatterTransition");
		piece1.addClass("wolfScatter");

		// $(piece1).css({
		// 	position: "absolute",
		// 	left: piece1X + 60,
		// 	top: piece1Y + 30
		// });
		// $(piece2).css({
		// 	position: "absolute",
		// 	left: piece2X + 400,
		// 	top: piece2Y + 10
		// });
		// $(piece3).css({
		// 	position: "absolute",
		// 	left: piece3X + 150,
		// 	top: piece3Y + 30
		// });
	}

	document.addEventListener("DOMContentLoaded", function (event) {
		document.getElementById('fade1').className += ' fade';
		document.getElementById('fade2').className += ' fade';
		document.getElementById('fade3').className += ' fade';
	});

	$(function () {
		$('#fade1').removeClass('fade');
		$('#fade2').removeClass('fade');
		$('#fade3').removeClass('fade');
	});

	let mouseXPos;
	let mouseYPos;
	let pigTarget;
	let wolfDraggable = true;

	document.addEventListener("dragover", function (event) {
		//updateMatCoords();
		mouseXPos = event.x;
		mouseYPos = event.y;
	});


	var img = new Image();
	img.src = 'imgs/blank.png';

	document.addEventListener("dragstart", function (event) {
		//updateMatCoords();
		pigTarget = "#" + event.path[1].id;
		event.dataTransfer.setData("text/plain", event.target.id);
		event.dataTransfer.setDragImage(img, 0, 0);

		scaleAnimation(pigTarget);


	});

	document.addEventListener("drag", function (event) {
		//updateMatCoords();

		if ((pigTarget == "#draggableMat1") && wolfDraggable) {
			$(`${pigTarget}`).css({
				position: "absolute",
				left: mouseXPos - 40,
				top: mouseYPos - 60
			});
		}


		hayX = $(".grayMatGroup")[0].offsetLeft;
		hayY = $(".grayMatGroup")[0].offsetTop;
		wolfX = $(".wolfChar")[0].offsetLeft;
		wolfY = $(".wolfChar")[0].offsetTop;

		if (((mouseXPos > (hayX - 45)) && (mouseXPos < (hayX + 50))) && ((mouseYPos > (hayY - 15)) && (mouseYPos <
			(hayY + 500)))) {
				console.log("there they go");
				if ((pigTarget == "#draggableMat1") && wolfDraggable) {
					// playScatter();
					wolfScatter();

				}
				if (wolfDraggable) {
					playRadar(wolfX, wolfY, "#FF5EBE");
					wolfDraggable = false;
					checkForEnd();
				}

				scaleAnimation(pigTarget);
			}


		});


		function checkForEnd() {
			$link = $("body").attr("href");



			setTimeout(function () {
				$("#content").fadeOut(500, function () {
					$("body").removeClass("blackFade");
					window.location = $link;
				});
			}, 2000);
		}
		</script>
	</body>

	</html>
